# データをグルーピングできる

## グルーピング

給与情報(salaries テーブル)から、従業員ごとに salary が何レコード登録されているかを取得し、

従業員番号と登録レコード数を 10 件表示してください。

```
SELECT emp_no, COUNT(salary) as record_count
FROM salaries
GROUP BY emp_no
LIMIT 10;
```

```
+--------+--------------+
| emp_no | record_count |
+--------+--------------+
|  10001 |           17 |
|  10002 |            6 |
|  10003 |            7 |
|  10004 |           16 |
|  10005 |           13 |
|  10006 |           12 |
|  10007 |           14 |
|  10008 |            3 |
|  10009 |           18 |
|  10010 |            6 |
+--------+--------------+
```

このクエリは、salaries テーブルから従業員番号（emp_no）と salary カラムを選択し、

GROUP BY 句を使用して従業員番号（emp_no）でグルーピングしています。

次に、COUNT() 集約関数を使用して、それぞれの従業員の salary レコード数をカウントします。

最後に、LIMIT 句を使用して、結果の最初の 10 件のみを取得しています。

---

## グルーピングと集計関数

従業員番号 10001 から 10010 の従業員ごとの最小給与と最大給与を取得してください。

```
SELECT emp_no, MIN(salary) AS min_salary, MAX(salary) AS max_salary
FROM salaries
WHERE emp_no BETWEEN 10001 AND 10010
GROUP BY emp_no;
```

```
+--------+------------+------------+
| emp_no | min_salary | max_salary |
+--------+------------+------------+
|  10001 |      60117 |      88958 |
|  10002 |      65828 |      72527 |
|  10003 |      40006 |      43699 |
|  10004 |      40054 |      74057 |
|  10005 |      78228 |      94692 |
|  10006 |      40000 |      60098 |
|  10007 |      56724 |      88070 |
|  10008 |      46671 |      52668 |
|  10009 |      60929 |      94443 |
|  10010 |      72488 |      80324 |
+--------+------------+------------+
```

このクエリは、salaries テーブルから従業員番号（emp_no）と salary(給料)カラムを選択し、

WHERE 句を使用して従業員番号が 10001 から 10010 の範囲にあるデータに絞り込んでいます。

次に、GROUP BY 句を使用して従業員番号（emp_no）でグルーピングし、MIN() および MAX() 集約関数を使用して、

それぞれの従業員の最小給与と最大給与を取得しています。

---

## グルーピングと集計関数 2

従業員番号 10001 から 10010 の従業員ごとの勤務開始日と勤務終了日を取得してください。

なお勤務中の場合、勤務終了日は 9999-01-01 となります。

```
SELECT emp_no, MIN(from_date) AS start_date, MAX(to_date) AS end_date
FROM salaries
WHERE emp_no BETWEEN 10001 AND 10010
GROUP BY emp_no;
```

```
+--------+------------+------------+
| emp_no | start_date | end_date   |
+--------+------------+------------+
|  10001 | 1986-06-26 | 9999-01-01 |
|  10002 | 1996-08-03 | 9999-01-01 |
|  10003 | 1995-12-03 | 9999-01-01 |
|  10004 | 1986-12-01 | 9999-01-01 |
|  10005 | 1989-09-12 | 9999-01-01 |
|  10006 | 1990-08-05 | 9999-01-01 |
|  10007 | 1989-02-10 | 9999-01-01 |
|  10008 | 1998-03-11 | 2000-07-31 |
|  10009 | 1985-02-18 | 9999-01-01 |
|  10010 | 1996-11-24 | 9999-01-01 |
+--------+------------+------------+
```

このクエリは、salaries テーブルから従業員番号（emp_no）、勤務開始日（from_date）、勤務終了日（to_date）のカラムを選択し、

WHERE 句を使用して従業員番号が 10001 から 10010 の範囲にあるデータに絞り込んでいます。

次に、GROUP BY 句を使用して従業員番号（emp_no）でグルーピングし、MIN() および MAX() 集約関数を使用して、

それぞれの従業員の勤務開始日と勤務終了日を取得しています。勤務中の場合、勤務終了日は '9999-01-01' となることが前提となっています。

---

## 絞り込み

従業員ごとの最大給与を求め、そのうち最大給与が 140,000 を超えている従業員の従業員番号と最大給与を取得してください。

```
SELECT emp_no, MAX(salary) AS max_salary
FROM salaries
GROUP BY emp_no
HAVING max_salary > 140000
LIMIT 5;
```

```
+--------+------------+
| emp_no | max_salary |
+--------+------------+
|  11486 |     145732 |
|  12149 |     141114 |
|  13386 |     144434 |
|  14487 |     144534 |
|  18006 |     144866 |
+--------+------------+
```

このクエリは、salaries テーブルから従業員番号（emp_no）と salary カラムを選択し、

GROUP BY 句を使用して従業員番号（emp_no）でグルーピングしています。

次に、MAX() 集約関数を使用して、それぞれの従業員の最大給与を計算します。

最後に、HAVING 句を使用して、最大給与が 140,000 を超えている従業員のみを絞り込んでいます。

---

## 最小給与

従業員番号 10001 から 10100 の従業員のうち、最小給与が 40,000 を下回っている従業員の従業員番号とその最小給与を取得してください。

```
SELECT emp_no, MIN(salary) AS min_salary
FROM salaries
WHERE emp_no BETWEEN 10001 AND 10100
GROUP BY emp_no
HAVING min_salary < 40000;
```

```
+--------+------------+
| emp_no | min_salary |
+--------+------------+
|  10022 |      39935 |
|  10027 |      39520 |
|  10037 |      39765 |
|  10048 |      39507 |
|  10049 |      39735 |
|  10064 |      39551 |
|  10072 |      39567 |
+--------+------------+
```

このクエリは、salaries テーブルから従業員番号（emp_no）と salary カラムを選択し、

WHERE 句を使用して従業員番号が 10001 から 10100 の範囲にあるデータに絞り込んでいます。

次に、GROUP BY 句を使用して従業員番号（emp_no）でグルーピングし、

MIN() 集約関数を使用して、それぞれの従業員の最小給与を計算します。

最後に、HAVING 句を使用して、最小給与が 40,000 を下回っている従業員のみを絞り込んでいます。

---

## 最終勤務日

従業員番号 10001 から 10100 の従業員のうち、勤務が終了している従業員の従業員番号と最後の勤務終了日を取得してください。

なお勤務中の場合、勤務終了日は 9999-01-01 となります。

```
SELECT emp_no, MAX(to_date) AS last_end_date
FROM salaries
WHERE emp_no BETWEEN 10001 AND 10100
GROUP BY emp_no
HAVING last_end_date < '9999-01-01';
```

```
+--------+---------------+
| emp_no | last_end_date |
+--------+---------------+
|  10008 | 2000-07-31    |
|  10011 | 1996-11-09    |
|  10015 | 1993-08-22    |
|  10021 | 2002-07-15    |
|  10025 | 1997-10-15    |
|  10028 | 1998-04-06    |
|  10033 | 1993-03-24    |
|  10034 | 1999-10-31    |
|  10042 | 2000-08-10    |
|  10048 | 1987-01-27    |
|  10055 | 1995-07-22    |
|  10064 | 1992-03-02    |
|  10073 | 1998-02-22    |
|  10075 | 2001-01-15    |
|  10082 | 1990-01-15    |
|  10087 | 2001-01-09    |
|  10090 | 1999-05-07    |
|  10094 | 1997-11-08    |
|  10098 | 1992-12-11    |
+--------+---------------+
```

このクエリは、salaries テーブルから従業員番号（emp_no）と勤務終了日（to_date）のカラムを選択し、

WHERE 句を使用して従業員番号が 10001 から 10100 の範囲にあるデータに絞り込んでいます。

次に、GROUP BY 句を使用して従業員番号（emp_no）でグルーピングし、

MAX() 集約関数を使用して、それぞれの従業員の最後の勤務終了日を取得します。

最後に、HAVING 句を使用して、勤務が終了している従業員（勤務終了日が '9999-01-01' でない）のみを絞り込んでいます
